{"version":3,"file":"imageCropperComponent.js","sourceRoot":"","sources":["../../src/imageCropperComponent.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  Component,\n  Input,\n  Renderer2,\n  ViewChild,\n  ElementRef,\n  Output,\n  EventEmitter,\n  Type,\n  AfterViewInit,\n  OnChanges,\n  OnDestroy,\n  SimpleChanges\n} from \"@angular/core\";\nimport { ImageCropper } from \"./imageCropper\";\nimport { CropperSettings } from \"./cropperSettings\";\nimport { Exif } from \"./exif\";\nimport { Bounds } from \"./model/bounds\";\nimport { CropPosition } from \"./model/cropPosition\";\n\n@Component({\n  selector: \"img-cropper\",\n  template: `\n        <span class=\"ng2-imgcrop\">\n          <input *ngIf=\"!settings.noFileInput\" #fileInput type=\"file\" accept=\"image/*\" (change)=\"fileChangeListener($event)\">\n          <canvas #cropcanvas\n                  (mousedown)=\"onMouseDown($event)\"\n                  (mouseup)=\"onMouseUp($event)\"\n                  (mousemove)=\"onMouseMove($event)\"\n                  (mouseleave)=\"onMouseUp($event)\"\n                  (touchmove)=\"onTouchMove($event)\"\n                  (touchend)=\"onTouchEnd($event)\"\n                  (touchstart)=\"onTouchStart($event)\">\n          </canvas>\n        </span>\n      `\n})\nexport class ImageCropperComponent\n  implements AfterViewInit, OnChanges, OnDestroy {\n  @ViewChild(\"cropcanvas\", undefined)\n  cropcanvas: ElementRef;\n  @ViewChild(\"fileInput\") fileInput: ElementRef;\n\n  @Input(\"settings\") public settings: CropperSettings;\n  @Input(\"image\") public image: any;\n  @Input(\"inputImage\") public inputImage: any;\n  @Input() public cropper: ImageCropper;\n  @Input() public cropPosition: CropPosition;\n  @Output()\n  public cropPositionChange: EventEmitter<CropPosition> = new EventEmitter<\n    CropPosition\n  >();\n\n  @Output() public onCrop: EventEmitter<any> = new EventEmitter();\n  @Output() imageSet: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  public croppedWidth: number;\n  public croppedHeight: number;\n  public intervalRef: number;\n  public raf: number;\n  public renderer: Renderer2;\n  public windowListener: EventListenerObject;\n\n  private isCropPositionUpdateNeeded: boolean;\n\n  constructor(renderer: Renderer2) {\n    this.renderer = renderer;\n  }\n\n  public ngAfterViewInit(): void {\n    let canvas: HTMLCanvasElement = this.cropcanvas.nativeElement;\n\n    if (!this.settings) {\n      this.settings = new CropperSettings();\n    }\n\n    if (this.settings.cropperClass) {\n      this.renderer.setAttribute(canvas, \"class\", this.settings.cropperClass);\n    }\n\n    if (!this.settings.dynamicSizing) {\n      this.renderer.setAttribute(\n        canvas,\n        \"width\",\n        this.settings.canvasWidth.toString()\n      );\n      this.renderer.setAttribute(\n        canvas,\n        \"height\",\n        this.settings.canvasHeight.toString()\n      );\n    } else {\n      this.windowListener = this.resize.bind(this);\n      window.addEventListener(\"resize\", this.windowListener);\n    }\n\n    if (!this.cropper) {\n      this.cropper = new ImageCropper(this.settings);\n    }\n\n    this.cropper.prepare(canvas);\n  }\n\n  public ngOnChanges(changes: SimpleChanges): void {\n    if (this.isCropPositionChanged(changes)) {\n      this.cropper.updateCropPosition(this.cropPosition.toBounds());\n      if (this.cropper.isImageSet()) {\n        let bounds = this.cropper.getCropBounds();\n        this.image.image = this.cropper.getCroppedImageHelper().src;\n        this.onCrop.emit(bounds);\n      }\n      this.updateCropBounds();\n    }\n\n    if (changes.inputImage) {\n      this.setImage(changes.inputImage.currentValue);\n    }\n\n    if (changes.settings && this.cropper) {\n      this.cropper.updateSettings(this.settings);\n      if (this.cropper.isImageSet()) {\n        this.image.image = this.cropper.getCroppedImageHelper().src;\n        this.onCrop.emit(this.cropper.getCropBounds());\n      }\n    }\n  }\n\n  public ngOnDestroy() {\n    if (this.settings.dynamicSizing && this.windowListener) {\n      window.removeEventListener(\"resize\", this.windowListener);\n    }\n  }\n\n  public onTouchMove(event: TouchEvent): void {\n    this.cropper.onTouchMove(event);\n  }\n\n  public onTouchStart(event: TouchEvent): void {\n    this.cropper.onTouchStart(event);\n  }\n\n  public onTouchEnd(event: TouchEvent): void {\n    this.cropper.onTouchEnd(event);\n    if (this.cropper.isImageSet()) {\n      this.image.image = this.cropper.getCroppedImageHelper().src;\n      this.onCrop.emit(this.cropper.getCropBounds());\n      this.updateCropBounds();\n    }\n  }\n\n  public onMouseDown(event: MouseEvent): void {\n    this.cropper.onMouseDown(event);\n    // if (!this.cropper.isImageSet() && !this.settings.noFileInput) {\n    //   // load img\n    //   this.fileInput.nativeElement.click();\n    // }\n  }\n\n  public onMouseUp(event: MouseEvent): void {\n    if (this.cropper.isImageSet()) {\n      this.cropper.onMouseUp(event);\n      this.image.image = this.cropper.getCroppedImageHelper().src;\n      this.onCrop.emit(this.cropper.getCropBounds());\n      this.updateCropBounds();\n    }\n  }\n\n  public onMouseMove(event: MouseEvent): void {\n    this.cropper.onMouseMove(event);\n  }\n\n  public fileChangeListener($event: any) {\n    if ($event.target.files.length === 0) return;\n\n    let file: File = $event.target.files[0];\n    if (this.settings.allowedFilesRegex.test(file.name)) {\n      let image: any = new Image();\n      let fileReader: FileReader = new FileReader();\n\n      fileReader.addEventListener(\"loadend\", (loadEvent: any) => {\n        image.addEventListener(\"load\", () => {\n          this.setImage(image);\n        });\n        image.src = loadEvent.target.result;\n      });\n\n      fileReader.readAsDataURL(file);\n    }\n  }\n\n  private resize() {\n    let canvas: HTMLCanvasElement = this.cropcanvas.nativeElement;\n    this.settings.canvasWidth = canvas.offsetWidth;\n    this.settings.canvasHeight = canvas.offsetHeight;\n    this.cropper.resizeCanvas(canvas.offsetWidth, canvas.offsetHeight, true);\n  }\n\n  public reset(): void {\n    this.cropper.reset();\n    this.renderer.setAttribute(\n      this.cropcanvas.nativeElement,\n      \"class\",\n      this.settings.cropperClass\n    );\n    this.image.image = this.cropper.getCroppedImageHelper().src;\n  }\n\n  public setImage(image: HTMLImageElement, newBounds: any = null) {\n    this.imageSet.emit(true);\n    this.renderer.setAttribute(\n      this.cropcanvas.nativeElement,\n      \"class\",\n      `${this.settings.cropperClass} ${this.settings.croppingClass}`\n    );\n    this.raf = window.requestAnimationFrame(() => {\n      if (this.raf) {\n        window.cancelAnimationFrame(this.raf);\n      }\n      if (image.naturalHeight > 0 && image.naturalWidth > 0) {\n        image.height = image.naturalHeight;\n        image.width = image.naturalWidth;\n\n        window.cancelAnimationFrame(this.raf);\n        this.getOrientedImage(image, (img: HTMLImageElement) => {\n          if (this.settings.dynamicSizing) {\n            let canvas: HTMLCanvasElement = this.cropcanvas.nativeElement;\n            this.settings.canvasWidth = canvas.offsetWidth;\n            this.settings.canvasHeight = canvas.offsetHeight;\n            this.cropper.resizeCanvas(\n              canvas.offsetWidth,\n              canvas.offsetHeight,\n              false\n            );\n          }\n\n          this.cropper.setImage(img);\n          if (this.cropPosition && this.cropPosition.isInitialized()) {\n            this.cropper.updateCropPosition(this.cropPosition.toBounds());\n          }\n\n          this.image.original = img;\n          let bounds = this.cropper.getCropBounds();\n          this.image.image = this.cropper.getCroppedImageHelper().src;\n\n          if (!this.image) {\n            this.image = image;\n          }\n\n          if (newBounds != null) {\n            bounds = newBounds;\n            this.cropper.setBounds(bounds);\n            this.cropper.updateCropPosition(bounds);\n          }\n          this.onCrop.emit(bounds);\n        });\n      }\n    });\n  }\n\n  private isCropPositionChanged(changes: SimpleChanges): boolean {\n    if (\n      this.cropper &&\n      changes[\"cropPosition\"] &&\n      this.isCropPositionUpdateNeeded\n    ) {\n      return true;\n    } else {\n      this.isCropPositionUpdateNeeded = true;\n      return false;\n    }\n  }\n\n  private updateCropBounds(): void {\n    let cropBound: Bounds = this.cropper.getCropBounds();\n    this.cropPositionChange.emit(\n      new CropPosition(\n        cropBound.left,\n        cropBound.top,\n        cropBound.width,\n        cropBound.height\n      )\n    );\n    this.isCropPositionUpdateNeeded = false;\n  }\n\n  private getOrientedImage(image: HTMLImageElement, callback: Function) {\n    let img: any;\n\n    Exif.getData(image, function() {\n      let orientation = Exif.getTag(image, \"Orientation\");\n\n      if ([3, 6, 8].indexOf(orientation) > -1) {\n        let canvas: HTMLCanvasElement = document.createElement(\"canvas\"),\n          ctx: CanvasRenderingContext2D = <CanvasRenderingContext2D>canvas.getContext(\n            \"2d\"\n          ),\n          cw: number = image.width,\n          ch: number = image.height,\n          cx: number = 0,\n          cy: number = 0,\n          deg: number = 0;\n\n        switch (orientation) {\n          case 3:\n            cx = -image.width;\n            cy = -image.height;\n            deg = 180;\n            break;\n          case 6:\n            cw = image.height;\n            ch = image.width;\n            cy = -image.height;\n            deg = 90;\n            break;\n          case 8:\n            cw = image.height;\n            ch = image.width;\n            cx = -image.width;\n            deg = 270;\n            break;\n          default:\n            break;\n        }\n\n        canvas.width = cw;\n        canvas.height = ch;\n        ctx.rotate(deg * Math.PI / 180);\n        ctx.drawImage(image, cx, cy);\n        img = document.createElement(\"img\");\n        img.width = cw;\n        img.height = ch;\n        img.addEventListener(\"load\", function() {\n          callback(img);\n        });\n        img.src = canvas.toDataURL(\"image/png\");\n      } else {\n        img = image;\n        callback(img);\n      }\n    });\n  }\n}\n"]}